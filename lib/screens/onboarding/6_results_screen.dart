import 'package:flutter/material.dart';
import 'package:flutter_animate/flutter_animate.dart';
import '../../theme/app_theme.dart';
import '../../widgets/bottom_navigation.dart';

class ResultsScreen extends StatefulWidget {
  const ResultsScreen({super.key});

  @override
  State<ResultsScreen> createState() => _ResultsScreenState();
}

class _ResultsScreenState extends State<ResultsScreen> {
  bool _showResults = false;
  int _loadingStep = 0;

  final List<String> _loadingMessages = [
    '‚úì –û–ø—Ä–µ–¥–µ–ª–∏–ª —Ç–≤–æ–π DISC —Ç–∏–ø',
    '‚úì –†–∞—Å—Å—á–∏—Ç–∞–ª —á–µ—Ä—Ç—ã —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞',
    '‚úì –í—ã—è–≤–∏–ª –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ —Å—Ñ–µ—Ä—ã',
    '‚úì –ù–∞—à–µ–ª –∑–æ–Ω—ã —Ä–æ—Å—Ç–∞',
    'üí° –°–æ–±–∏—Ä–∞—é –∏–Ω—Å–∞–π—Ç—ã...',
  ];

  @override
  void initState() {
    super.initState();
    _startLoading();
  }

  void _startLoading() {
    // –ú–µ–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 1.6 —Å–µ–∫ (8 —Å–µ–∫ / 5 —Å–æ–æ–±—â–µ–Ω–∏–π)
    Future.delayed(const Duration(milliseconds: 1600), () {
      if (mounted) {
        setState(() => _loadingStep = 1);
      }
    });
    Future.delayed(const Duration(milliseconds: 3200), () {
      if (mounted) {
        setState(() => _loadingStep = 2);
      }
    });
    Future.delayed(const Duration(milliseconds: 4800), () {
      if (mounted) {
        setState(() => _loadingStep = 3);
      }
    });
    Future.delayed(const Duration(milliseconds: 6400), () {
      if (mounted) {
        setState(() => _loadingStep = 4);
      }
    });
    Future.delayed(const Duration(milliseconds: 8000), () {
      if (mounted) {
        setState(() => _showResults = true);
      }
    });
  }

  @override
  Widget build(BuildContext context) {
    if (!_showResults) {
      return _buildLoadingScreen();
    }
    return _buildResultsScreen();
  }

  Widget _buildLoadingScreen() {
    final screenHeight = MediaQuery.of(context).size.height;

    return Scaffold(
      backgroundColor: AppColors.background,
      body: SafeArea(
        child: Center(
          child: Column(
            mainAxisAlignment: MainAxisAlignment.center,
            children: [
              // –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≥—Ä–∏–±
              Text(
                'üçÑ',
                style: TextStyle(fontSize: screenHeight * 0.1),
              )
                  .animate(
                    onPlay: (controller) => controller.repeat(),
                  )
                  .scale(
                    duration: 1500.ms,
                    begin: const Offset(1.0, 1.0),
                    end: const Offset(1.2, 1.2),
                    curve: Curves.easeInOut,
                  )
                  .then()
                  .scale(
                    duration: 1500.ms,
                    begin: const Offset(1.2, 1.2),
                    end: const Offset(1.0, 1.0),
                    curve: Curves.easeInOut,
                  ),

              SizedBox(height: screenHeight * 0.05),

              // –°–ø–∏–Ω–Ω–µ—Ä
              const CircularProgressIndicator(
                valueColor: AlwaysStoppedAnimation<Color>(AppColors.primaryPurple),
              ),

              SizedBox(height: screenHeight * 0.05),

              // –ó–∞–≥–æ–ª–æ–≤–æ–∫
              Text(
                'üîÆ –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é —Ç–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å...',
                style: AppTextStyles.h2.copyWith(fontSize: screenHeight * 0.025),
              ),

              SizedBox(height: screenHeight * 0.02),

              // –°–º–µ–Ω—è—é—â–∏–µ—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è
              SizedBox(
                height: screenHeight * 0.12,
                child: Column(
                  children: List.generate(
                    _loadingMessages.length,
                    (index) => AnimatedOpacity(
                      duration: const Duration(milliseconds: 500),
                      opacity: _loadingStep >= index ? 1.0 : 0.3,
                      child: Padding(
                        padding: EdgeInsets.symmetric(vertical: screenHeight * 0.002),
                        child: Text(
                          _loadingMessages[index],
                          style: AppTextStyles.body.copyWith(
                            color: _loadingStep >= index
                                ? AppColors.success
                                : Colors.white60,
                            fontSize: screenHeight * 0.016,
                          ),
                          maxLines: 1,
                          overflow: TextOverflow.ellipsis,
                        ),
                      ),
                    ),
                  ),
                ),
              ),

              SizedBox(height: screenHeight * 0.025),

              // "–ì–æ—Ç–æ–≤–æ! –°–º–æ—Ç—Ä–∏ ‚Üì"
              if (_loadingStep >= 4)
                Text(
                  '–ì–æ—Ç–æ–≤–æ! –°–º–æ—Ç—Ä–∏ ‚Üì',
                  style: AppTextStyles.h3.copyWith(
                    color: AppColors.success,
                    fontSize: screenHeight * 0.02,
                  ),
                )
                    .animate()
                    .fadeIn(duration: 500.ms)
                    .slideY(begin: 0.3, end: 0, duration: 500.ms),
            ],
          ),
        ),
      ),
    );
  }

  Widget _buildResultsScreen() {
    final screenHeight = MediaQuery.of(context).size.height;

    return Scaffold(
      backgroundColor: AppColors.background,
      body: SafeArea(
        child: SingleChildScrollView(
          padding: EdgeInsets.all(screenHeight * 0.02),
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              // –ó–∞–≥–æ–ª–æ–≤–æ–∫
              Text(
                'üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –¢—ã —Ç–µ–ø–µ—Ä—å —á–∞—Å—Ç—å Mycelium!',
                style: AppTextStyles.h1.copyWith(fontSize: screenHeight * 0.03),
                maxLines: 2,
                overflow: TextOverflow.ellipsis,
              ).animate().fadeIn(duration: 600.ms).slideY(
                    begin: -0.2,
                    end: 0,
                    duration: 600.ms,
                  ),

              SizedBox(height: screenHeight * 0.01),

              Text(
                '–¢—ã —Å—Ç–∞–ª —á–∞—Å—Ç—å—é –≥—Ä–∏–±–Ω–∏—Ü—ã.',
                style: AppTextStyles.body.copyWith(
                  color: Colors.white60,
                  fontSize: screenHeight * 0.016,
                ),
                maxLines: 1,
                overflow: TextOverflow.ellipsis,
              ).animate(delay: 200.ms).fadeIn(duration: 400.ms),

              SizedBox(height: screenHeight * 0.04),

              // –¢–∏–ø –ª–∏—á–Ω–æ—Å—Ç–∏
              Container(
                padding: EdgeInsets.all(screenHeight * 0.02),
                decoration: BoxDecoration(
                  gradient: LinearGradient(
                    colors: [
                      AppColors.primaryPurple.withOpacity(0.2),
                      AppColors.accentBlue.withOpacity(0.2),
                    ],
                  ),
                  borderRadius: BorderRadius.circular(20),
                  border: Border.all(
                    color: AppColors.primaryPurple.withOpacity(0.3),
                    width: 1,
                  ),
                ),
                child: Column(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    Text(
                      'üé≠ –¢–≤–æ–π —Ç–∏–ø: –°–¢–†–ê–¢–ï–ì-–í–ò–ó–ò–û–ù–ï–†',
                      style: AppTextStyles.h2.copyWith(fontSize: screenHeight * 0.022),
                      maxLines: 2,
                      overflow: TextOverflow.ellipsis,
                    ),
                    SizedBox(height: screenHeight * 0.02),
                    Text(
                      '–ü—Ä–∏—Ä–æ–∂–¥–µ–Ω–Ω—ã–π –ª–∏–¥–µ—Ä —Å –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º –º—ã—à–ª–µ–Ω–∏–µ–º.',
                      style: AppTextStyles.body.copyWith(
                        color: Colors.white70,
                        fontSize: screenHeight * 0.017,
                      ),
                      maxLines: 2,
                      overflow: TextOverflow.ellipsis,
                    ),
                  ],
                ),
              )
                  .animate(delay: 400.ms)
                  .fadeIn(duration: 600.ms)
                  .slideY(begin: 0.2, end: 0, duration: 600.ms),

              SizedBox(height: screenHeight * 0.02),

              // –°—É–ø–µ—Ä—Å–∏–ª—ã
              Text(
                '‚ú® –°–£–ü–ï–†–°–ò–õ–´:',
                style: AppTextStyles.h3.copyWith(fontSize: screenHeight * 0.02),
                maxLines: 1,
                overflow: TextOverflow.ellipsis,
              ).animate(delay: 600.ms).fadeIn(duration: 400.ms),

              SizedBox(height: screenHeight * 0.015),

              _buildBulletPoint(
                '‚ö° –†–µ—à–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö',
                800,
                screenHeight,
              ),
              _buildBulletPoint(
                'üéØ –í–∏–¥–∏—à—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≥–¥–µ –¥—Ä—É–≥–∏–µ –≤–∏–¥—è—Ç –ø—Ä–æ–±–ª–µ–º—ã',
                900,
                screenHeight,
              ),
              _buildBulletPoint(
                'üöÄ –ù–µ –±–æ–∏—à—å—Å—è —Ä–∏—Å–∫–æ–≤–∞—Ç—å –∏ –ø—Ä–æ–±–æ–≤–∞—Ç—å –Ω–æ–≤–æ–µ',
                1000,
                screenHeight,
              ),

              SizedBox(height: screenHeight * 0.02),

              // –í—ã–∑–æ–≤—ã
              Text(
                '‚ö†Ô∏è –í–´–ó–û–í–´:',
                style: AppTextStyles.h3.copyWith(fontSize: screenHeight * 0.02),
                maxLines: 1,
                overflow: TextOverflow.ellipsis,
              ).animate(delay: 1100.ms).fadeIn(duration: 400.ms),

              SizedBox(height: screenHeight * 0.015),

              _buildBulletPoint(
                '- –ù–µ—Ç–µ—Ä–ø–µ–ª–∏–≤ –∫ –º–µ–¥–ª–µ–Ω–Ω—ã–º –ª—é–¥—è–º',
                1200,
                screenHeight,
              ),
              _buildBulletPoint(
                '- –ú–æ–∂–µ—à—å –∑–∞–¥–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏—Ö —Å–≤–æ–µ–π —ç–Ω–µ—Ä–≥–∏–µ–π',
                1300,
                screenHeight,
              ),
              _buildBulletPoint(
                '- –î–µ—Ç–∞–ª–∏ –∏ —Ä—É—Ç–∏–Ω–∞ –≤—ã–∑—ã–≤–∞—é—Ç —Å–∫—É–∫—É',
                1400,
                screenHeight,
              ),

              SizedBox(height: screenHeight * 0.04),

              // –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
              Divider(
                color: Colors.white.withOpacity(0.1),
                thickness: 1,
              ),

              SizedBox(height: screenHeight * 0.04),

              // –ß—Ç–æ –¥–∞–ª—å—à–µ
              Text(
                'üí° –ß–¢–û –î–ê–õ–¨–®–ï?',
                style: AppTextStyles.h2.copyWith(fontSize: screenHeight * 0.022),
                maxLines: 1,
                overflow: TextOverflow.ellipsis,
              ).animate(delay: 1500.ms).fadeIn(duration: 400.ms),

              SizedBox(height: screenHeight * 0.015),

              Text(
                '–°–µ–π—á–∞—Å –ø–æ–ø–∞–¥–µ—à—å –≤ mCode ‚Äî —Ç–≤–æ—é –±–∞–∑—É —Ä–æ—Å—Ç–∞.',
                style: AppTextStyles.body.copyWith(
                  color: Colors.white70,
                  fontSize: screenHeight * 0.016,
                ),
                maxLines: 2,
                overflow: TextOverflow.ellipsis,
              ).animate(delay: 1600.ms).fadeIn(duration: 400.ms),

              SizedBox(height: screenHeight * 0.015),

              _buildBulletPoint(
                'üéØ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ä–∞–∑–≤–∏—Ç–∏—è',
                1700,
                screenHeight,
              ),
              _buildBulletPoint(
                'üéÆ P2P —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ (—Å 5 —É—Ä–æ–≤–Ω—è)',
                1800,
                screenHeight,
              ),
              _buildBulletPoint(
                'üèÜ –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞',
                1900,
                screenHeight,
              ),

              SizedBox(height: screenHeight * 0.02),

              Text(
                '–¢—ã –≥–æ—Ç–æ–≤ –Ω–∞—á–∞—Ç—å –ø—É—Ç—å –≤ Mycelium?',
                style: AppTextStyles.h3.copyWith(fontSize: screenHeight * 0.019),
                maxLines: 2,
                overflow: TextOverflow.ellipsis,
              ).animate(delay: 2100.ms).fadeIn(duration: 400.ms),

              SizedBox(height: screenHeight * 0.02),

              // –ö–Ω–æ–ø–∫–∞
              SizedBox(
                width: double.infinity,
                height: screenHeight * 0.065,
                child: ElevatedButton(
                  onPressed: () {
                    Navigator.of(context).pushReplacement(
                      MaterialPageRoute(
                        builder: (_) => const MainNavigator(),
                      ),
                    );
                  },
                  style: ElevatedButton.styleFrom(
                    backgroundColor: AppColors.primaryPurple,
                    foregroundColor: Colors.white,
                    shape: RoundedRectangleBorder(
                      borderRadius: BorderRadius.circular(16),
                    ),
                    elevation: 0,
                  ),
                  child: Row(
                    mainAxisAlignment: MainAxisAlignment.center,
                    children: [
                      Text(
                        '–í–æ–π—Ç–∏ –≤ mCode',
                        style: AppTextStyles.h3.copyWith(
                          color: Colors.white,
                        ),
                      ),
                      const SizedBox(width: 8),
                      const Icon(Icons.arrow_forward, size: 20),
                    ],
                  ),
                ),
              )
                  .animate(delay: 2200.ms)
                  .fadeIn(duration: 600.ms)
                  .slideY(begin: 0.3, end: 0, duration: 600.ms),

              SizedBox(height: screenHeight * 0.02),
            ],
          ),
        ),
      ),
    );
  }

  Widget _buildBulletPoint(String text, int delayMs, double screenHeight) {
    return Padding(
      padding: EdgeInsets.only(bottom: screenHeight * 0.01),
      child: Text(
        text,
        style: AppTextStyles.body.copyWith(
          color: Colors.white70,
          fontSize: screenHeight * 0.016,
        ),
        maxLines: 2,
        overflow: TextOverflow.ellipsis,
      ).animate(delay: delayMs.ms).fadeIn(duration: 400.ms).slideX(
            begin: -0.2,
            end: 0,
            duration: 400.ms,
          ),
    );
  }
}
